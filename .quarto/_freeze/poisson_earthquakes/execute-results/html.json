{
  "hash": "c025bbe1186e026f7a0e62de68d01e13",
  "result": {
    "markdown": "---\ntitle: \"Poisson Modelling\"\nauthor: \"Brittany Alexandra\"\ndate: \"2025-06-01\"\n\nformat:\n  html:\n    theme: cerulean\n    toc: true\n    toc-depth: 2          \n    toc-location: left    \n    code-fold: true\n    code-tools: true\n\neditor_options: \n  markdown: \n    wrap: 72\n---\n\n\n# Introduction\n\n------------------------------------------------------------------------\n\nWhen is the next volcano due to erupt? Any moment now, unfortunately!\n(Give or take 1000 years or so).\n\nA volcano could happen this afternoon, or it might not happen for\nanother 1000 years. Volcanoes are almost impossible to predict; they\nseem to happen completely at random.\n\nHowever, we do know of a statistical distribution that counts the number\nof events in a fixed space of time...the Poisson distribution! The\nPoisson process counts the number of events occurring in a fixed time or\nspace, when events occur independently and at a constant average rate,\nwhere the formula for our statistical model is as follows:\n\n$Y_i \\sim \\text{Poisson}(\\mu_i),$ where $\\mu_i = \\beta_0 + \\beta_1 x_i\\quad$\n\nDiving a bit into understanding the foundations of how we will use this\nstatistical model in R... It is worth noting that we need to use a link\nfunction to map our parameter of interest, $\\mu_i$ , to the real number\nline, where $log(\\mu_i) = \\beta_0 + \\beta_1 x_i$.\n\nIn other words, the expected value of our response variable, $\\mu_i$,\nmust be non negative $(\\mu_i\\ â‰¥ 0)$. However, because we are using a\nlog-link function, the model actually estimates $\\log(\\mu_i)$ which can\ntake on any real number, that is $- \\infty < \\log(\\mu_i) < +\\infty$\n\n\nToday, we will look at how to use the poisson distribution to model the\noccurrence of volcanic events per year in Country A. This country is\ncomposed of smaller areas that regularly record information on the\nfollowing:\n\n-   area.type: Categorical variable with 9 categories.\n\n-   total.land.area: Total land area in square kms\n\n-   total.area: Total area (including water) in square kms\n\n-   shape.length: Length of the shape of the area in kms\n\n-   UrbanRural: Recoded variable area.type into bigger categories\n\n-   previous.eruption: Number of previous volcanic eruptions in the are\n\n-   Y: Number of eruptions during the observation period. The\n    observation time is ONE\\\n    year for all areas.\n\n-   earthquakes.year: Average number of earthquakes per year in the area\n\nA quick note, *this blog is not focused on the exploratory part of this\ndata, and will not go in-depth to all the metrics and terms used, but I\naim to add another page soon explaining the terminology!*\n\n\n\n\n\n# Step 1. Choosing variables to include in the model\n\n------------------------------------------------------------------------\n\nEach analysis begins with selecting which variables to include in our\nmodel. Contrary to intuition, we do **not** want to include every\nvariable available --- for several key reasons:\n\n-   **Occam's Razor** suggests that, all else equal, simpler models are\n    preferable to more complex ones.\n\n-   Including too many variables can introduce **multicollinearity**,\n    where highly correlated predictors make coefficient estimates\n    unstable and unreliable.\n\n[**The methods to identify appropriate explanatory variables are listed\nbelow (this is specific to our analysis):**]{.underline}\n\n1.  **Domain knowledge:** Always the most important source of insight.\n    **Correlation plots:** Useful for detecting multicollinearity\n    between explanatory variables.\n\n2.  **Chi-square tests:** To test for associations between categorical\n    variables.\n\n3.  **Akaike Information Criterion (AIC):** Balances model fit with\n    model complexity to guide selection relative to comparative models.\n\nWe aim to choose explanatory variables that are **strongly associated\nwith the response variable** while avoiding those that are **highly\ncorrelated with each other**. We will walk through choosing appropriate\nvariables to model our response, Y, with an example, focusing on the\nvariables `area.type` and `UrbanRural`\n\nIn the pairs plot below, we can see `area.type` and `UrbanRural`are\nmoderately colinear with a correlation of 0.42 and therefore only one\nshould in the model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs20x(data)\n```\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n### 1.1 Domain Knowledge\n\nIt's important to ask whether there **is a contextual benefit** to\nincluding `area.type` or `UrbanRural`. As we are interested in modelling\nthe frequency of eruptions, and not the impact of specific area types, I\nam unbiased as to which variable we include in the model from a\ncontextual standpoint.\n\n### 1.2 Chi-square Tests\n\nAs established by our pairs plot, it looks like we face a few colinear\nvariables, and we are interested in looking into `UrbanRural` and\n`area.type`.\n\nWe can test the hypothesis that they both variables contain similar\ninformation using a chi-square test. This test **checks for a\nstatistically significant association between two categorical\nvariables**, with the null hypothesis being that there is there is no\nassociation between two categorical variables.\n\n$$\nH_0: \\text{The two categorical variables are independent.}\n$$\n\nBelow, we can see the test result has a small p-value of 0.0005, thus\nshowing **no evidence to reject the null hypothesis** --- suggesting\nthat the distribution of `UrbanRural` and `area.type` categories is\nlikely due to chance, and they are **not significantly different**.\n\nGiven `area.type` and `UrbanRural` are not statistically different, and\nthey have eight anad three levels, respectively, we will opt for the\nsimpler explanatory variable with three levels, `UrbanRural`.\n\nWhy do we want to **reduce our model complexity?** Well, **simpler\nmodels are easier to interpret when we are quantifying their impact on\nthe response**. Remember, this is statistical modelling NOT machine\nlearning. We need to be able to explain every part going on, and the\neffect each variable has on the result.\n\nFrom a computational standpoint, it enables a faster convergence of\nmodels, allows parameter coefficients to be more stable, and helps\navoids overfitting.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n # We can see that we have a small p-value of 0.00049 (p-val < 0.05), therefore have no evidence to reject the null hypothesis that the observed distribution difference across the categories 'UrbanRural` and `area.type` is due to chance \ntabledata <- table(data$UrbanRural, data$area.type)\nchiResult <- chisq.test(tabledata, simulate.p.value = TRUE, B = 2000)\n\n# Clean summary\ncat(\"Chi-squared test (with simulated p-value, B = 2000):\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nChi-squared test (with simulated p-value, B = 2000):\n```\n:::\n\n```{.r .cell-code}\ncat(\"X-squared =\", round(chiResult$statistic, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nX-squared = 37478 \n```\n:::\n\n```{.r .cell-code}\ncat(\"Degrees of freedom =\", chiResult$parameter, \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDegrees of freedom = NA \n```\n:::\n\n```{.r .cell-code}\ncat(\"P-value =\", format.pval(chiResult$p.value, digits = 4, eps = 1e-4), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nP-value = 0.0004998 \n```\n:::\n:::\n\n\n### 1.3 AIC\n\nAIC is a likelihood based metric often used to compare two statistical\nmodels. A lower AIC is favourable to a higher AIC, as it indicates a\nbetter blend of model complexity while still explaining the data well.\n\nIt's important to note that **there is no single \"correct\" way to choose\nvariables**. For instance, `UrbanRural` has a slightly higher AIC\n(253157) than `area.type` (253043), but the difference is marginal and\nin my personal opinion, not worth incorporating into the model due to\nits additional levels. (UrbanRural has 3 levels while area.type has 5).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1 <- glm(Y ~ UrbanRural, family = \"poisson\", data = data)\nmodel2 <- glm(Y ~ area.type, family = \"poisson\", data = data)\n\n# Create comparison data frame\ncomparison <- data.frame(\n  Model = c(\"UrbanRural\", \"Area Type\"),\n  AIC = c(AIC(model1), AIC(model2)))\n\n# Pretty table\ncomparison %>%\n  kable(\"html\", caption = \"<strong> Model Comparison: AIC </strong>\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\", \"condensed\", \"responsive\"), \n                full_width = FALSE, \n                position = \"center\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed table-responsive\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption><strong> Model Comparison: AIC </strong></caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Model </th>\n   <th style=\"text-align:right;\"> AIC </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> UrbanRural </td>\n   <td style=\"text-align:right;\"> 253157.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Area Type </td>\n   <td style=\"text-align:right;\"> 253042.8 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nLastly, our plots indicate both variables follow similar distribution\npatterns. The effect of `Sea`, which only has three observations, is\nnegligible and including it would risk biasing our model due to its\nhigher proportion of earthquakes, but smaller sample size.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(patchwork)\n\n# Ensure categorical variables are factors\ndata <- data %>%\n  mutate(\n    UrbanRural = factor(UrbanRural),\n    area.type = factor(area.type)\n  )\n\n# --- Add counts directly to data frame ---\ndata_urban <- data %>%\n  group_by(UrbanRural) %>%\n  mutate(n = n()) %>%\n  ungroup()\n\ndata_area <- data %>%\n  group_by(area.type) %>%\n  mutate(n = n()) %>%\n  ungroup()\n\n# --- Plot for UrbanRural ---\np1 <- ggplot(data_urban, aes(x = UrbanRural, y = Y)) +\n  geom_boxplot(fill = \"lightpink\") +\n  stat_summary(\n    fun = max, geom = \"text\",\n    aes(label = paste0(\"n = \", n)),\n    vjust = -0.5, size = 3\n  ) +\n  labs(\n    title = \"Earthquakes per Urban/Rural Area\",\n    x = \"UrbanRural\",\n    y = \"Earthquakes per Year\"\n  ) +\n  theme_minimal()\n\n# --- Plot for area.type ---\np2 <- ggplot(data_area, aes(x = area.type, y = Y)) +\n  geom_boxplot(fill = \"lightblue\") +\n  stat_summary(\n    fun = max, geom = \"text\",\n    aes(label = paste0(\"n = \", n)),\n    vjust = -0.5, size = 3\n  ) +\n  labs(\n    title = \"Earthquakes per Area Type\",\n    x = \"Area Type\",\n    y = \"Earthquakes per Year\"\n  ) +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n# --- Combine plots side by side ---\np1\n```\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-4-1.png){width=1152}\n:::\n\n```{.r .cell-code}\np2\n```\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-4-2.png){width=1152}\n:::\n:::\n\n\n# Step 2: Fitting the model\n\n------------------------------------------------------------------------\n\nGiven that the response variable, Y, represents a count of discrete\npositive numbers, we have chosen to apply a generalized linear model\nthat utilities a Poisson distribution to predict Y, the frequency of\neruptions.\n\nTo convert the expected average count of eruptions, denoted as Âµi, from\nthe Poisson distribution into a linear predictor, we have used the **log\nlink function**. This is because we must ensure all expected values are\ngreater than 0 (our model should not output an expected negative amount\nof earthquakes!), account for non constant variance, and assume a\ndiscrete responses (we can't have 2.5 earthquakes either! what would\nhalf an earthquake mean?)\n\nWe have used explanatory variables; `previous.eruption`, `UrbanRural`,\n`earthquakes.year`, and `total.area`. All explanatory variables had\nsignificant contributions towards explaining model variance (pval :\n\\<2e-16).\n\nWe will initially fit a model with all the variables and see which is\nthe optimal outcome based on which model has the lowest AIC, thereby\npenalizing model complexity and rewarding goodness of fit. In addition,\nWe iteratively removed insignificant variables each model to final\nconverge on glm_model4, which had the (subjectively) best combination of\nlow AIC and low model complexity.\n\nHowever, not all assumptions were not satisfied, as we can see an\nincrease in variance with an increase in the Y (number of eruptions) as\nthe mean increases. If our model was perfect, our predicted values would\nfollow closely to the purple line.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n############################################################\n# Split data into test and training\n############################################################\ntrain_index <- createDataPartition(data$Y, p = 0.8, list = FALSE)\ntrain_data <- data[train_index, ]\ntest_data <- data[-train_index, ]\n\n\n#Fit model with all predictor variables and see what the model tries best with stepwise regression \nglm_model1 <- glm(Y ~ previous.eruption + UrbanRural + shape.length + total.area + total.land.area + earthquakes.year, family = \"poisson\", data = train_data)\n#summary(glm_model1)\n\nglm_model2 <- glm(Y ~ previous.eruption + earthquakes.year + UrbanRural + total.area + shape.length, data = train_data, family = poisson)\n# summary(glm_model2)\n\nglm_model3 <- glm(Y ~ UrbanRural + previous.eruption + earthquakes.year, data = train_data, family = poisson)\n# summary(glm_model3)\n\n# Best model \nglm_model4 <- glm(Y ~ previous.eruption + earthquakes.year + UrbanRural + total.area, family = poisson, data = train_data)\n#summary(glm_model4)\n\n\n# MODEL COMPARISON \n#glm_model3 has the best median between low AIC and low model complexity \nAIC(glm_model1, glm_model2, glm_model3, glm_model4)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           df      AIC\nglm_model1  8 147011.3\nglm_model2  7 147015.8\nglm_model3  5 147619.6\nglm_model4  6 147034.7\n```\n:::\n\n```{.r .cell-code}\npredictions_glm4 <- predict(glm_model4, newdata = test_data, type = \"response\")\ntest_data$predictions_glm4 <- predictions_glm4\n\n# kind of bad model \nggplot(test_data, aes(x = Y, y = predictions_glm4, col = UrbanRural)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"loess\", se = FALSE) +\n  geom_line(aes(x = Y, y = Y), color = \"purple\", alpha = 0.5) + # Ideal fit line\n  labs(x = \"Actual\", y = \"Predicted\", title = \"Actual vs. Predicted values from chosen Poisson model \") + \n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n##############################\n# Fit model with full data now \n##############################\nglm_model3_full <- glm(Y ~ UrbanRural + previous.eruption + earthquakes.year + total.area,\n                 family = \"poisson\", data = data)\n\n# summary(glm_model3_full)\n```\n:::\n\n\n# Step 3: Diagnostic checks on our chosen model\n\n------------------------------------------------------------------------\n\nBelow, we run diagnostic checks on our chosen model\n\n1.  The **Chi-squared ANOVA** checks if all levels are significant\n    within our model. For example, the `UrbanRural` variable has 3\n    levels (*degrees of freedom +1*) , and we can see from the\n    significant P-value of \\<2.2e-16 that they are all significant.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    # All levels are significant for our best model\n    anova(glm_model4, test = \"Chisq\")\n    ```\n    \n    ::: {.cell-output .cell-output-stdout}\n    ```\n    Analysis of Deviance Table\n    \n    Model: poisson, link: log\n    \n    Response: Y\n    \n    Terms added sequentially (first to last)\n    \n                      Df Deviance Resid. Df Resid. Dev  Pr(>Chi)    \n    NULL                              14993     161666              \n    previous.eruption  1    56281     14992     105386 < 2.2e-16 ***\n    earthquakes.year   1      178     14991     105208 < 2.2e-16 ***\n    UrbanRural         2    10817     14989      94391 < 2.2e-16 ***\n    total.area         1      587     14988      93804 < 2.2e-16 ***\n    ---\n    Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n    ```\n    :::\n    :::\n\n\n2.  **Cooks distance** measures the influence of a specific data point\n    on the overall model. For example, it quantifies how much the models\n    predictions would change if these datapoints were removed. Below, we\n    can see there are a few datapoints that clearly stick out, but all\n    have a distance under 0.5 so we are not concerned about their\n    influence.\n\n\n    ::: {.cell}\n    \n    ```{.r .cell-code}\n    # A simple function to generate a cooks distance plot \n    cooks20x(glm_model3)\n    ```\n    \n    ::: {.cell-output-display}\n    ![](poisson_earthquakes_files/figure-html/unnamed-chunk-7-1.png){width=672}\n    :::\n    :::\n\n\n3.  We use a **normality check** to see how the residuals of our model\n    are distributed. Residuals are the differences between the observed\n    values and the values predicted by out model, simply put as\n\n$$\nr_i = y_i - \\hat{y}_i$.\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnormcheck(glm_model3)\n```\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n# Step 4: Quantifying the impact of our variables on the frequency of earthquakes\n\n------------------------------------------------------------------------\n\nWe have evidence to reject the null hypothesis that the model is a good\nfit (pval : 0) .\n\nAll variables were significant in explaining the variance in our\nresponse (p-val \\< 0.05).\n\nHowever, we can visually see that this model still offers some useful\ninformation from the above plot.\n\nHolding all other variables constant:\n\n-   We estimate that, for every 1 square km increase in total area, the\n    expected number of eruptions for a given time period increases by\n    1.86%\n\n-   We estimate that, for every 1 unit increase in previous eruptions,\n    the expected number of eruptions for a given time period decrease by\n    76.61%\n\n-   We estimate that, for every 1 unit increase in earthquakes.year\n    (average number of earthquakes per year in the area), the expected\n    number of eruptions for a given time period increase by 4.13%.\n\n-   We estimate that the expected number of earthquakes in a given time\n    period for the \"Settlement\" Urban Rural category is 26.3% higher\n    than the expected number of earthquakes in the \"Other\" category.\n\n-   We estimate that the expected number of earthquakes in a given time\n    period for the \"Urban\" Urban Rural category is 44.84% lower than the\n    expected number of earthquakes in the \"Other\" category.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(glm_model3_full) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Y ~ UrbanRural + previous.eruption + earthquakes.year + \n    total.area, family = \"poisson\", data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-6.9865  -2.3027  -0.7174   1.2060  10.2700  \n\nCoefficients:\n                             Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                 3.1674850  0.0079876  396.55   <2e-16 ***\nUrbanRuralRural settlement  0.2337399  0.0131489   17.78   <2e-16 ***\nUrbanRuralUrban            -0.5950103  0.0078943  -75.37   <2e-16 ***\nprevious.eruption          -1.4528968  0.0070815 -205.17   <2e-16 ***\nearthquakes.year            0.0404475  0.0027978   14.46   <2e-16 ***\ntotal.area                  0.0184193  0.0006451   28.55   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 200101  on 18738  degrees of freedom\nResidual deviance: 116577  on 18733  degrees of freedom\nAIC: 183123\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\n100*(exp(coef(glm_model3_full))-1)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n               (Intercept) UrbanRuralRural settlement \n               2274.768259                  26.331584 \n           UrbanRuralUrban          previous.eruption \n                -44.844311                 -76.610823 \n          earthquakes.year                 total.area \n                  4.127662                   1.858996 \n```\n:::\n:::\n\n\n# Step 5: Adding more complexity to our model to improve its explanatory power\n\n------------------------------------------------------------------------\n\nGreat! Now that we have established our baseline model, it's time to see\nhow we can improve it one way to do this is by adding interaction\neffects. Interaction effects take into account the effect of one\nexplanatory variable on the response variable, depending on the level of\nanother explanatory variable. For example, our `UrbanRural` variable has\n3 levels, and the effect of each level on the response may differ based\non the other explanatory variables.\n\nBelow, we explore one interaction effect, and notice a distinction\nbetween previous.eruption and earthquakes.year. The interaction was fit\nand kept due it's significant p-value (pval : \\< 2.2e-16).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##############################\n# Lets investigate the relationships\n##############################\nfit1 <- glm(Y ~ previous.eruption*earthquakes.year, data = data, family = poisson)\ninteract_plot(fit1, pred = previous.eruption, modx = earthquakes.year)\n```\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nAfter comparing our previous simple poisson model, with our current\npoisson model with an interaction effect, we can see the interaction\nmodel actually provides a lower AIC!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##############################\n# Fit model with full data now \n##############################\nglm_model5 <- glm(Y ~ previous.eruption*earthquakes.year + UrbanRural + total.area, family = poisson, data = data)\nsummary(glm_model5) # All significant \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Y ~ previous.eruption * earthquakes.year + UrbanRural + \n    total.area, family = poisson, data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-6.9849  -2.0430  -0.5682   1.2069   9.8643  \n\nCoefficients:\n                                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                         3.121215   0.008044  388.01   <2e-16 ***\nprevious.eruption                  -1.002563   0.009295 -107.87   <2e-16 ***\nearthquakes.year                    0.093767   0.002908   32.24   <2e-16 ***\nUrbanRuralRural settlement          0.233251   0.013147   17.74   <2e-16 ***\nUrbanRuralUrban                    -0.597354   0.007891  -75.70   <2e-16 ***\ntotal.area                          0.018134   0.000645   28.12   <2e-16 ***\nprevious.eruption:earthquakes.year -0.599499   0.010139  -59.12   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 200101  on 18738  degrees of freedom\nResidual deviance: 112713  on 18732  degrees of freedom\nAIC: 179261\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\nAIC(glm_model4, glm_model5)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in AIC.default(glm_model4, glm_model5): models are not all fitted to\nthe same number of observations\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n           df      AIC\nglm_model4  6 147034.7\nglm_model5  7 179261.2\n```\n:::\n:::\n\n\nWe can also see the predictions from this model perform slightly better\nthan our previous model.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##############################\n# SHOW PREDICTIONS\n##############################\npredictions_glm5 <- predict(glm_model5, newdata = test_data, type = \"response\")\ntest_data$predictions_glm5 <- predictions_glm5\n\n# kind of bad model \nggplot(test_data, aes(x = Y, y = predictions_glm5, col = UrbanRural)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"loess\", se = FALSE) +\n  geom_line(aes(x = Y, y = Y), color = \"red\", alpha = 0.5) + # Ideal fit line\n  labs(x = \"Actual\", y = \"Predicted\", title = \"Actual vs. Predicted Poisson model \") + \n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](poisson_earthquakes_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\nSimilar to step Step 2, we must run diagnostic checks on our model.\nAfter all, we can't blindly code something and believe it to be\naccurate!\n\nWe can see our interaction is significant with a p-value of \\<2.2e-17\n\n\n::: {.cell}\n\n```{.r .cell-code}\nanova(glm_model5, test = \"Chisq\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n\nModel: poisson, link: log\n\nResponse: Y\n\nTerms added sequentially (first to last)\n\n                                   Df Deviance Resid. Df Resid. Dev  Pr(>Chi)\nNULL                                               18738     200101          \nprevious.eruption                   1    69679     18737     130423 < 2.2e-16\nearthquakes.year                    1      184     18736     130238 < 2.2e-16\nUrbanRural                          2    12950     18734     117288 < 2.2e-16\ntotal.area                          1      711     18733     116577 < 2.2e-16\nprevious.eruption:earthquakes.year  1     3864     18732     112713 < 2.2e-16\n                                      \nNULL                                  \nprevious.eruption                  ***\nearthquakes.year                   ***\nUrbanRural                         ***\ntotal.area                         ***\nprevious.eruption:earthquakes.year ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n\n```{.r .cell-code}\n# ##############################\n# # Diagnostic checks\n# ##############################\n# cooks20x(glm_model5)\n# plot(glm_model5, lty = 2, pch = substr(data$UrbanRural, 1, 1))\n```\n:::\n\n\n# Step 6: Concluding statements and interpretations from our final model\n\n------------------------------------------------------------------------\n\nAs the response variable, number of eruptions during the observation\nperiod, is a count, we have fit a generalized linear model with a\nPoisson response distribution.\n\nWe have 5 significant explanatory terms (pval all \\<0.05);\nearthquakes.year, total.area, previous.eruption, total.area, and\nUrbanRural. The interaction plot above suggests a difference between the\nexpected number of eruptions depending on how many eruptions there were\nin the previous year (per area) and the average number of eruptions (per\narea).\n\nHence, a poisson model with an interaction term between\nprevious.eruption and earthquakes.year was fit. The interaction term was\nsignificant (pval : \\< 2e-16) so it remained in the model.\n\nAll assumptions were satisfied. However, we still cannot trust the\nresults from the Poisson model (pval: 0 )\n\nHolding all other variables constant...\n\n-   We estimate that, for every 1 unit increase in the number of\n    previous volcanic eruptions (previous.eruptions), the expected\n    number eruptions in a given time period decreases by 63.3%.\n\n    -   This is further decreased by 45.1% for every increase in the\n        average number of earthquakes per year in the area\n        (earthquakes.year)\n\n-   We estimate that, for every 1 unit increase in the number of average\n    earthquakes per year, the expected number of eruptions in a given\n    time period increases by 9.83%.\n\n    -   There is further decreased by 45.1% for every increase the\n        number of previous volcanic eruptions (previous.eruption).\n\n-   We estimate that, for every 1 square km increase in total area, the\n    expected number of eruptions in a given time period increases by\n    1.83%\n\n-   We estimate that the expected number of eruptions in a given time\n    period is 44.97% lower in \"Urban\" (UrbanRural) areas compared to\n    \"Other\" areas\n\n-   We estimate that the expected number of eruptions in a given period\n    is 26.27% higher in \"Settlement\" (UrbanRural) areas compared to\n    \"Other areas\"\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(glm_model5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nglm(formula = Y ~ previous.eruption * earthquakes.year + UrbanRural + \n    total.area, family = poisson, data = data)\n\nDeviance Residuals: \n    Min       1Q   Median       3Q      Max  \n-6.9849  -2.0430  -0.5682   1.2069   9.8643  \n\nCoefficients:\n                                    Estimate Std. Error z value Pr(>|z|)    \n(Intercept)                         3.121215   0.008044  388.01   <2e-16 ***\nprevious.eruption                  -1.002563   0.009295 -107.87   <2e-16 ***\nearthquakes.year                    0.093767   0.002908   32.24   <2e-16 ***\nUrbanRuralRural settlement          0.233251   0.013147   17.74   <2e-16 ***\nUrbanRuralUrban                    -0.597354   0.007891  -75.70   <2e-16 ***\ntotal.area                          0.018134   0.000645   28.12   <2e-16 ***\nprevious.eruption:earthquakes.year -0.599499   0.010139  -59.12   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for poisson family taken to be 1)\n\n    Null deviance: 200101  on 18738  degrees of freedom\nResidual deviance: 112713  on 18732  degrees of freedom\nAIC: 179261\n\nNumber of Fisher Scoring iterations: 5\n```\n:::\n\n```{.r .cell-code}\n# pval_glm_model5 <- 1 - pchisq(90402, 14987)\n# print(paste(\"We cannot still trust the most optimal model found as it has a small p-value of\", pval_glm_model5, \"indicating the poisson model does not provide a good fit \"))\n\n#Interpreting coefficients\n100*(exp(coef(glm_model5))-1)  \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       (Intercept)                  previous.eruption \n                       2167.392233                         -63.306220 \n                  earthquakes.year         UrbanRuralRural settlement \n                          9.830385                          26.269789 \n                   UrbanRuralUrban                         total.area \n                        -44.973416                           1.829907 \nprevious.eruption:earthquakes.year \n                        -45.091323 \n```\n:::\n:::\n\n\n# Extra : Mathematical interpretation of our model\n\n------------------------------------------------------------------------\n\n[Our final model is:]{.underline}\n\n$$\nlog(\\mu_i)=\\beta_0+\\beta_1p_i+\\beta_2e_i+\\beta_3s_i+\\beta_4u_i+\\beta_5t_i+\\beta_6p_ie_i\n$$\n\nWhere :\n\n-   $\\mu_i$ is the number of eruptions during the observation period and\n    Y (the expected number of eruptions in the \"Other\" Urban Area) has a\n    poisson distribution with mean $\\mu_i$\n\n-   $\\text{p}_{i}$ represents the number of previous eruptions in the\n    area\n\n-   $\\text{e}_{i}$ represents the average number of earthquakes per year\n    in the area\n\n-   The factor variable $\\text{UrbanRural}$ has 3 dummy variables where\n    $\\text{s}_{i}$ takes the value 1 if the observation is from\n    Settlement and 0 otherwise. In addition $\\text{u}_{i}$ takes the\n    value 1 if the observation is from Urban, and 0 otherwise.\n\n-   $\\text{t}_{i}$ represents the total area (including water) in square\n    km.\n\nHere, \"Other\" (within the `UrbanRural` factor) is our baseline level.\n",
    "supporting": [
      "poisson_earthquakes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}